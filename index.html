<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chordle</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="https://unpkg.com/vexflow@3.0.9/releases/vexflow-min.js"></script>
    <script src="jquery-3.6.0.min.js"></script>
    <script src="audiosynth.js"></script>
    <script src="https://unpkg.com/tone"></script>

    <script>
        function treatAsUTC(date) {
            var result = new Date(date);
            result.setMinutes(result.getMinutes() - result.getTimezoneOffset());
            return result;
        }

        function daysBetween(startDate, endDate) {
            var millisecondsPerDay = 24 * 60 * 60 * 1000;
            return Math.floor((treatAsUTC(endDate) - treatAsUTC(startDate)) / millisecondsPerDay);
        }

        const chordleNumber = Math.max(daysBetween(new Date("3/22/2022"), new Date()), 0);
    </script>

    <div id="overlayBackground" hidden>
        <div id="endscreen" class="endingScreen">
            <h2 id="endscreenText"></h2>
            <p id="chordleNum" style="padding-top: 2rem;">CHORDLE</p>
            <div id="basesheet" class="staff"></div>
            <div id="endNextDisplay">
                <p>NEXT CHORDLE</p>
                <h2 id="clock"></h2>

                <script>
                    document.getElementById("chordleNum").innerHTML = "CHORDLE " + chordleNumber;

                    function getCountDownString(){
                        const date = new Date();
                        let seconds = (59 - date.getSeconds()).toString().padStart(2, '0');
                        let minutes = (59 - date.getMinutes()).toString().padStart(2, '0');
                        let hours = (23 - date.getHours()).toString().padStart(2, '0');

                        return `${hours}:${minutes}:${seconds}`;
                    }

                    function updateTimer(){
                        document.getElementById('clock').innerHTML = getCountDownString();
                        setTimeout(updateTimer, 1000)
                    }

                    updateTimer();
                </script>
            </div>
        </div>
    </div>

    <div id="header">
        <h1>      
            <!-- <button id="help-button" class="icon" aria-label="help" style="text-align: left;">
                <help-icon>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
                        <path fill="#3a3a3c" d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"></path>
                    </svg>
                </help-icon>
            </button> -->
            CHORDLE
        </h1>
    </div>
    <div id="chords">

    </div>
    <div id="game-board">
        <div id="sheet0" class="staff"></div>
        <div id="sheet1" class="staff"></div>
        <div id="sheet2" class="staff"></div>
        <div id="sheet3" class="staff"></div>
        <div id="sheet4" class="staff"></div>
        <div id="sheet5" class="staff"></div>
    </div>
    <div id="piano-keyboard">
        <div class="piano-buttons" style="display: flex; justify-content: space-between;">
            <div style="left:0;">
                <button class="piano-button" id="pbl8" onclick="game.changeLength(8)">ùÖù</button>
                <button class="piano-button" id="pbl4" onclick="game.changeLength(4)">ùÖû</button>
                <button class="piano-button" id="pbl2" onclick="game.changeLength(2)">ùÖü</button>
                <button class="piano-button" id="pbl1" onclick="game.changeLength(1)">ùÖ†</button>
                <button class="piano-button" id="pbl0" onclick="game.changeLength(0)">ùÖ¢</button>
                <button class="piano-button" id="pbdot" onclick="game.toggleDot()">‚Ä¢</button>
                <button class="piano-button" id="pbup" onclick="game.toggleOctave()">^</button>
                <button class="piano-button" id="pbr" onclick="game.pushRest()">ùÑΩ</button>
            </div>
            <div style="right:0;">
                <button class="piano-button" onclick="playToneTest(game.baselineSequence)">‚ñ∂</button>
                <button class="piano-button">c</button>
            </div>
        </div>
        <div class="keys">
            <div class="key"        onclick="game.pushNote( 0)"></div>
            <div class="key black"  onclick="game.pushNote( 1)"></div>
            <div class="key"        onclick="game.pushNote( 2)"></div>
            <div class="key black"  onclick="game.pushNote( 3)"></div>
            <div class="key"        onclick="game.pushNote( 4)"></div>
            <div class="key"        onclick="game.pushNote( 5)"></div>
            <div class="key black"  onclick="game.pushNote( 6)"></div>
            <div class="key"        onclick="game.pushNote( 7)"></div>
            <div class="key black"  onclick="game.pushNote( 8)"></div>
            <div class="key"        onclick="game.pushNote( 9)"></div>
            <div class="key black"  onclick="game.pushNote(10)"></div>
            <div class="key"        onclick="game.pushNote(11)"></div>
        </div>
    </div>
    <script>
        var exports = {};
        function require(a){return null;}
    </script>
    <script src="sequences.js"></script>
    <script src="sequence.js"></script>
    <script src="sequencePlayer.js"></script>
    <script src="sequencePlayerNew.js"></script>
    <script src="renderer.js"></script>
    <script src="game.js"></script>
    <script>
        let game = new Game(sequenceFromFile(_daily_sequences, 0));
        game.changeLength(2)

        let overlayElement = document.getElementById("overlayBackground");
        let endscreenElement = document.getElementById("endscreen");
        let endscreenText = document.getElementById("endscreenText");

        game.Win = function(){
            overlayElement.classList.add("visible");
            $("#overlayBackground").fadeIn(1000);
            overlayElement.removeAttribute("hidden");
            endscreenText.innerHTML = "VICTORY!";
        }

        game.Lose = function(){
            overlayElement.classList.add("visible");
            $("#overlayBackground").fadeIn(1000);
            overlayElement.removeAttribute("hidden");
            endscreenText.innerHTML = "DEFEAT!";

        }

        drawSVG("basesheet", 0, 0, game.baselineSequence, 450)

        let chordElement = document.getElementById("chords");
        game.baselineSequence.chords.forEach(function(c) {
            const node = document.createElement("div");
            node.classList.add("chordSymbol");
            node.innerHTML = c.name;
            chordElement.appendChild(node);
        });
        const node = document.createElement("div");
        chordElement.appendChild(node);

        window.onkeydown = function(event) {
            switch(event.keyCode){
                case 8:
                    game.deleteNote(); 
                    break;
                case 13: 
                    game.advanceSequence(); 
                    break;
            }
        }

        if (navigator.requestMIDIAccess) {
            console.log('This browser supports WebMIDI!');
        } else {
            console.log('WebMIDI is not supported in this browser.');
        }
    </script>
</body>
</html>